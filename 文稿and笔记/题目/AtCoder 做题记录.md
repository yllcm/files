# AtCoder 做题记录

### AGC003E Sequential operations on Sequence

设 $f_u$ 为 $u$ 的状态，观察一下发现 $f_u$ 实际上是前面的区间拼起来，然后如果把这东西分解的话可以发现它不超过 $\log V$ 个区间，因为带个取模。最后考虑一个区间对答案的贡献，DAG 上 DP 即可。

### AGC003F Fraction of Fractal

没看到联通性的条件，感觉比 E 简单……

### AGC004E Salvage Robots

可以六次方。设 $(a,b,c,d,e,f)$ 表示当前偏移量和最大偏移量。

不过发现确定最大偏移之后剩下可以随便走，那就随便走，但是要减去之前可以随便走的区域。所以可以四次方 DP。

### AGC005E Sugigma: The Showdown

**题意：**

有一张 $n$ 个顶点的图，其中有 $2n-2$ 条边，边有红色边 $n-1$ 条和蓝色边 $n-1$ 条，它们分别构成两棵树。Alice 只能走红色边，Bob 只能走蓝色边，两个人在一起之后游戏结束。如果 Alice 希望最大化步数，Bob 希望最小化步数，问游戏什么时候中止，不会结束输出 $-1$。

**题解：**

感觉不难的，但是没做出来。

样例实际上已经提示了我们一种无穷的情况：如果一条红边中间有至少三条蓝色边，那么就无穷，所以这类边我们实际上不用管它，只需要标记点为特殊点即可。剩下的情况，我们在以 $y$ 为根的蓝树上讨论问题。那么边只有两种：

* 重边。即与蓝色边重合的红色边。
* 跳跃边。即跨过两条蓝色边的红色边。

考虑在这种条件下观察整个过程。Bob 从根出发，每次一定往 Alice 的方向走。Alice 需要尽可能走到特殊点，如果不能，需要走到离 Bob 最远的点。那么考虑 Bob 走到某个点的条件，其实比较简单，就是路径上不会被拦截，也就是对于路径上任意一个点，都满足 $D_b(y,u)\leq D_r(x,u)$。于是考虑 Bob 能否走到关键点即可。

为啥没有做出来呢？因为如果考虑一些心理博弈，比如说 Bob 虚晃一枪，Alice 来不及阻挡，Bob 趁乱钻入子树这种东西，问题就变得不可讨论了。实际上大多数情况下结论不会太复杂，很多情况下直觉上的结果就是对的。另外，如果在不同的模型上讨论问题，复杂程度也会不太一样，一般遇到不可讨论的情况，可以考虑一下直觉导出的结论是否已经正确，或者寻找更加清晰的模型解决问题。

### *ARC164E Segment-Tree Optimization

我也不知道为什么但是它就是过了。

考虑区间 DP。设 $f_{l,r}=(d_{l,r},c_{l,r})$ 表示当树根为区间 $[l,r]$ 时区间深度的最小值和最深位置访问次数的最小值。分两种情况：

* 所有询问要么包含 $[l,r]$，要么不包含。假设包含个数为 $c(l,r)$，那么 $f_{l,r}=(0,c(l,r))$。
* 存在询问和 $[l,r]$ 交叉。那么枚举断点 $k$。如果 $d_{l,k},d_{k+1,r}\neq 0$，那么可以直接令 $d_{l,r}=\max(d_{l,k},d_{k+1,r})$，并令 $c_{l,r}$ 为最大值出现次数。否则不妨设 $d_{l,k}=0$，我们需要修正一些贡献。
  * 完全包含 $[l,r]$ 的区间不再访问 $[l,k]$，而是会在访问到 $[l,r]$ 时停止，贡献为 $-c(l,r)$。
  * 和 $[l,r]$ 交叉但不与 $[l,k]$ 交叉的区间，此时会访问到 $[l,k]$ 然后停止。假设与 $[l,r]$ 不交叉区间数量为 $val_{l,r}$，贡献为 $val_{l,k}-val_{l,r}$。

直接 DP 可以 $\mathcal{O}(n^3)$。

考虑怎么优化。显然我是不太会优化的，但是我赌它有决策单调性，交上去就过了。具体实现类似石子合并，这里不再赘述。

关于决策单调性的证明，我不是很会，希望有 dalao 能把它补充上QAQ。

### *ARC164F Subtree Reversi

我来复读官方题解。

首先，一个节点的翻转次数是固定的，定义深度为到根经过的边数，则深度为偶数的节点最终颜色与刚刚放置时的颜色相等，深度为奇数的节点的最终颜色与刚刚放置时的颜色相反。假设深度为偶数的节点为红色，深度为奇数的节点为蓝色，那么假设 Alice 取了 $a$ 个蓝色节点，Bob 取了 $b$ 个蓝色节点，那么最后的答案是 $\left\lceil\dfrac{n}{2}\right\rceil-a+b$，说明 Alice 和 Bob 都希望能够最小化取到的蓝色节点个数。

假设 Bob 和 Alice 的策略均为：尽可能取红色节点，如果没有红色节点取则尽可能不让对方取到红色节点。那么如果某人取了一个节点，那么取完之后会引发一系列连锁反应，我们把取完某个节点之后，紧接着被取到的节点划分为一组。划分规则为：

* 如果有红色节点为叶子，那么红色节点为一组。
* 否则，去除所有已经分组了的节点，考虑所有满足其父亲有不止一个子节点的蓝色节点，将蓝色结点个数最小的满足上述条件的蓝色节点的子树划分为一组。
* 如此重复操作直至不能操作，剩下的节点为一组。

定义一组节点的权值为其中蓝色节点的个数，那么如果一个人取了这一组中的元素，那么它会取走这一组中所有的蓝色节点。那么策略为：按权值从小到大排序，两人一次取完一整组。注意到不会出现不合法的情况，即取完一个点的祖先再取这个点，因为可以发现存在祖先关系的组的权值是由子树到祖先递增的（由于我们率先取走了蓝色结点个数最小的子树）

为什么这样做是对的呢？考虑归纳证明。假设对于 $n$ 个点的树均满足上述规则，我们证明大小为 $n+1$ 的树仍然满足上述规则。

考虑反证，假设权值从小到大排序的结果为 $a,b,c\cdots,k,\cdots$，我们率先从权值为 $k$ 的组里面取走了一个结点，分类讨论：

* $k>1$，那么操作完之后会诞生一个红色叶子，取完红色叶子之后剩下的按规则处理，即两人取走的权值依次为 $1\to 0\to a\to b\to c\to \cdots \to k-1$，可以发现相比于原方案 $a\to b\to c\to \cdots \to k-1$，如果原本的方案中由后手取走了 $k$，那么后手相对于原来的方案要少取走一个结点，否则后手的方案不变。所以先手亏了。
* $k=1$，那么只有在 $a=0$ 的情况下才会有影响，此时方案为 $k=1\to a=0\to b\to c$，原来的方案为 $a=0\to k=1\to b\to c$，可以发现先手还是多取了一个结点。

所以结论成立。

[code](https://atcoder.jp/contests/arc164/submissions/43544520)

### *ARC163D Sum of SCC

一个思路是：

* 计数强联通竞赛图的数量使得合法边数恰好 $k$，记作 $f_{n,k}$。
* 每次往后面拼上一个强联通竞赛图并分配标号，得到的竞赛图数量为 $h_{n,k}$。

后者和前者基本相同，讨论前者。

考虑图计数 $f_{i,j}$ 的经典思路：容斥掉不合法的。具体地，枚举最后一个强联通分量的点数 $i-x$ 和边数 $z$，枚举新加了多少个边 $y$，记分配标号的方案为 $g_{i,i-x,y}$，这个容易 DP 的！直接枚举 $i,j,x,y,z$ 可以八次方，加上巨大卡常可以通过。

我写一下式子：
$$
f_{i,j}=p_{i,j}-\sum_{x}\sum_y\sum_z f_{i-x,z}p_{x,y}g_{i,i-x,j-y-z}
$$
这个是可以优化的！怎么优化呢？观察一下可以发现 $j$ 非常没有存在感，所以可以考虑最后枚举 $j$。$y,z$ 都不是很重要。所以考虑先枚举 $i,x$，然后预处理 $tmp_{y+z}=\sum f_{i-x,z},p_{x,y}$，最后枚举 $j$ 和 $y+z$，可以轻松转移到 $\mathcal{O}(n^6)$。

但是六次方还是太不牛了。考虑另外一个思路：计数划分 $(S,T)$ 表示只有 $S$ 向 $T$ 的连边。转移方式是插点，这个随便讨论一下就好了。

这种带权值的可以考虑组合意义的！想到计数划分可能是因为六次方做法里面每次加一个强连通竞赛图过于笨重了，所以需要考虑一些简洁的对强连通图的刻画。

### *ARC163E Chmin XOR Game

real ARC。

打一下 $n=2$ 的表，发现答案构成关于 $[0,3]\times [0,3]$ 的分形，那么结论是四进制下存在 Alice 必胜的方案！并且这个方案满足：恰好一个是 $0$ 或者两个相等。可以证明。

扩展到 $n>2$ 就是除了 $0$ 之外其它四进制下相等。复杂度 $\mathcal{O}(n\log V)$。

### ARC162D **Smallest Vertices**

简单 prufer。

首先树的数量是 $(n-2)!/\prod(d_i-[i=\text{root}])$。

prufer 序列刻画子树是困难的，考虑直接枚举每个点和其子树中的点集 $S$ 计算答案。容易发现子树内和子树外用 prufer 序列是独立的，所以可以直接做。

然后发现计算答案之和 $\sum d_i$ 和 $|S|$ 有关，直接三方 DP 即可。

### ARC162E **Strange Constraints**

考虑观察一下题目的限制。假设 $i$ 出现了 $C_i$ 次，那么 $C_i\leq A_i$，并且这些数只能放在满足 $C_i\leq A_i$ 的位置，如果 $A_i$ 排序，那么相当于放一个后缀。这说明如果知道序列 $C_i$ 那么计算方案是简单的，但是计算答案需要把 $C_i$ 排序就很愚蠢。

考虑直接在值域上考虑这个问题，记 $D_i$ 表示有多少个数满足 $C_j=i$，那么每次枚举往这里填几个数，需要考虑 $D_i$ 分配到哪几个数，以及这几个数分配到哪些位置，可以发现只有后面的分配会影响当前分配。那么记录 $(i,j,k,l)$ 表示 $i$ 后面分配了 $j$ 个数，和为 $k$，枚举当前加 $l$ 个数，方案是简单的组合数。看似复杂度是四次方，但是 $j,l\leq \dfrac{n}{i}$，因为 $\dfrac{1}{i^2}$ 收敛所以复杂度是 $\mathcal{O}(n^3)$。

### *ARC162F Montage

典，但是差点不会。

观察一下发现如果把空白的行列删掉，那么轮廓线一定是两条从左下到右上的边不交路径。

边不交路径怎么做？不会是 LGV 吧！想想想，发现根本没法 LGV。

尝试 DP，如果考虑找交点可以四次方，NTT 做差卷积可以三方 $\log$。

但是其实没必要，观察原问题的形态，相当于每列的 $1$ 都是一个区间，且区间有交且递增，这个可以直接 DP，前缀和优化即可。